rocio@cqen-rp:~/dev/training/workshops-openshift/openshiftv4-odo-workshop/kiosk/openshiftv4-odo-workshop$ terraform --version
Terraform v1.2.7
on linux_amd64
rocio@cqen-rp:~/dev/training/workshops-openshift/openshiftv4-odo-workshop/kiosk/openshiftv4-odo-workshop$ aws -- version

usage: aws [options] <command> <subcommand> [<subcommand> ...] [parameters]
To see help text, you can run:

  aws help
  aws <command> help
  aws <command> <subcommand> help

aws: error: argument command: Invalid choice, valid choices are:

accessanalyzer                           | account                                 
acm                                      | acm-pca                                 
alexaforbusiness                         | amp                                     
amplify                                  | amplifybackend                          
amplifyuibuilder                         | apigateway                              
apigatewaymanagementapi                  | apigatewayv2                            
appconfig                                | appconfigdata                           
appflow                                  | appintegrations                         
application-autoscaling                  | application-insights                    
applicationcostprofiler                  | appmesh                                 
apprunner                                | appstream                               
appsync                                  | athena                                  
auditmanager                             | autoscaling                             
autoscaling-plans                        | backup                                  
backup-gateway                           | batch                                   
braket                                   | budgets                                 
ce                                       | chime                                   
chime-sdk-identity                       | chime-sdk-meetings                      
chime-sdk-messaging                      | cloud9                                  
cloudcontrol                             | clouddirectory                          
cloudformation                           | cloudfront                              
cloudhsm                                 | cloudhsmv2                              
cloudsearch                              | cloudsearchdomain                       
cloudtrail                               | cloudwatch                              
codeartifact                             | codebuild                               
codecommit                               | codeguru-reviewer                       
codeguruprofiler                         | codepipeline                            
codestar                                 | codestar-connections                    
codestar-notifications                   | cognito-identity                        
cognito-idp                              | cognito-sync                            
comprehend                               | comprehendmedical                       
compute-optimizer                        | connect                                 
connect-contact-lens                     | connectparticipant                      
cur                                      | customer-profiles                       
databrew                                 | dataexchange                            
datapipeline                             | datasync                                
dax                                      | detective                               
devicefarm                               | devops-guru                             
directconnect                            | discovery                               
dlm                                      | dms                                     
docdb                                    | drs                                     
ds                                       | dynamodb                                
dynamodbstreams                          | ebs                                     
ec2                                      | ec2-instance-connect                    
ecr                                      | ecr-public                              
ecs                                      | efs                                     
eks                                      | elastic-inference                       
elasticache                              | elasticbeanstalk                        
elastictranscoder                        | elb                                     
elbv2                                    | emr                                     
emr-containers                           | es                                      
events                                   | evidently                               
finspace                                 | finspace-data                           
firehose                                 | fis                                     
fms                                      | forecast                                
forecastquery                            | frauddetector                           
fsx                                      | gamelift                                
glacier                                  | globalaccelerator                       
glue                                     | grafana                                 
greengrass                               | greengrassv2                            
groundstation                            | guardduty                               
health                                   | healthlake                              
honeycode                                | iam                                     
identitystore                            | imagebuilder                            
importexport                             | inspector                               
inspector2                               | iot                                     
iot-data                                 | iot-jobs-data                           
iot1click-devices                        | iot1click-projects                      
iotanalytics                             | iotdeviceadvisor                        
iotevents                                | iotevents-data                          
iotfleethub                              | iotsecuretunneling                      
iotsitewise                              | iotthingsgraph                          
iottwinmaker                             | iotwireless                             
ivs                                      | kafka                                   
kafkaconnect                             | kendra                                  
kinesis                                  | kinesis-video-archived-media            
kinesis-video-media                      | kinesis-video-signaling                 
kinesisanalytics                         | kinesisanalyticsv2                      
kinesisvideo                             | kms                                     
lakeformation                            | lambda                                  
lex-models                               | lex-runtime                             
lexv2-models                             | lexv2-runtime                           
license-manager                          | lightsail                               
location                                 | logs                                    
lookoutequipment                         | lookoutmetrics                          
lookoutvision                            | machinelearning                         
macie                                    | macie2                                  
managedblockchain                        | marketplace-catalog                     
marketplace-entitlement                  | marketplacecommerceanalytics            
mediaconnect                             | mediaconvert                            
medialive                                | mediapackage                            
mediapackage-vod                         | mediastore                              
mediastore-data                          | mediatailor                             
memorydb                                 | meteringmarketplace                     
mgh                                      | mgn                                     
migration-hub-refactor-spaces            | migrationhub-config                     
migrationhubstrategy                     | mobile                                  
mq                                       | mturk                                   
mwaa                                     | neptune                                 
network-firewall                         | networkmanager                          
nimble                                   | opensearch                              
opsworks                                 | opsworkscm                              
organizations                            | outposts                                
panorama                                 | personalize                             
personalize-events                       | personalize-runtime                     
pi                                       | pinpoint                                
pinpoint-email                           | pinpoint-sms-voice                      
polly                                    | pricing                                 
proton                                   | qldb                                    
qldb-session                             | quicksight                              
ram                                      | rbin                                    
rds                                      | rds-data                                
redshift                                 | redshift-data                           
rekognition                              | resiliencehub                           
resource-groups                          | resourcegroupstaggingapi                
robomaker                                | route53                                 
route53-recovery-cluster                 | route53-recovery-control-config         
route53-recovery-readiness               | route53domains                          
route53resolver                          | rum                                     
s3control                                | s3outposts                              
sagemaker                                | sagemaker-a2i-runtime                   
sagemaker-edge                           | sagemaker-featurestore-runtime          
sagemaker-runtime                        | savingsplans                            
schemas                                  | sdb                                     
secretsmanager                           | securityhub                             
serverlessrepo                           | service-quotas                          
servicecatalog                           | servicecatalog-appregistry              
servicediscovery                         | ses                                     
sesv2                                    | shield                                  
signer                                   | sms                                     
snow-device-management                   | snowball                                
sns                                      | sqs                                     
ssm                                      | ssm-contacts                            
ssm-incidents                            | sso                                     
sso-admin                                | sso-oidc                                
stepfunctions                            | storagegateway                          
sts                                      | support                                 
swf                                      | synthetics                              
textract                                 | timestream-query                        
timestream-write                         | transcribe                              
transfer                                 | translate                               
voice-id                                 | waf                                     
waf-regional                             | wafv2                                   
wellarchitected                          | wisdom                                  
workdocs                                 | worklink                                
workmail                                 | workmailmessageflow                     
workspaces                               | workspaces-web                          
xray                                     | s3api                                   
s3                                       | ddb                                     
configure                                | deploy                                  
configservice                            | opsworks-cm                             
history                                  | cli-dev                                 
help                                    

rocio@cqen-rp:~/dev/training/workshops-openshift/openshiftv4-odo-workshop/kiosk/openshiftv4-odo-workshop$ cd ../../../../
rocio@cqen-rp:~/dev/training$ ls -la<
bash: syntax error near unexpected token `newline'
rocio@cqen-rp:~/dev/training$ cd ..
rocio@cqen-rp:~/dev$ ls -la
total 68
drwxrwxr-x 14 rocio rocio 4096 Aug 11 12:15 .
drwxr-xr-x 45 rocio rocio 4096 Aug 17 10:44 ..
-rw-rw-r--  1 rocio rocio 4827 Aug 11 12:15 agenda_todos
drwxrwxr-x  2 rocio rocio 4096 May 16 11:18 architecture
drwxrwxr-x  7 rocio rocio 4096 Jul 20 14:41 backup
drwxrwxr-x 23 rocio rocio 4096 Jul 26 09:34 cqen
drwxrwxr-x  4 rocio rocio 4096 May 22 08:07 img
drwxrwxr-x 10 rocio rocio 4096 Jun 29 11:09 json
drwxrwxr-x  8 rocio rocio 4096 Jul 27 13:44 logs
drwxrwxr-x  5 rocio rocio 4096 Jan 20  2022 myrepo
drwxrwxr-x  2 rocio rocio 4096 Feb 16 11:58 ngrok
drwxrwxr-x  4 rocio rocio 4096 Mar 22 16:54 pipeline
drwxrwxr-x  3 rocio rocio 4096 Apr 13 09:23 security
-rw-rw-r--  1 rocio rocio 3991 Jun 26 08:40 someKubernetesDefinitions
drwxrwxr-x 12 rocio rocio 4096 Jun 29 10:51 training
drwxrwxr-x  3 rocio rocio 4096 Jan 20  2022 workshop
rocio@cqen-rp:~/dev$ cd cqen/
rocio@cqen-rp:~/dev/cqen$ cd tickets/
rocio@cqen-rp:~/dev/cqen/tickets$ ls -la
total 16
drwxrwxr-x  4 rocio rocio 4096 Jul  6 09:40 .
drwxrwxr-x 23 rocio rocio 4096 Jul 26 09:34 ..
drwxrwxr-x  6 rocio rocio 4096 May 24 11:49 ceai
drwxrwxr-x  4 rocio rocio 4096 Aug 10 16:58 innovation
rocio@cqen-rp:~/dev/cqen/tickets$ cd ceai/
rocio@cqen-rp:~/dev/cqen/tickets/ceai$ ls -la
total 236
drwxrwxr-x 6 rocio rocio  4096 May 24 11:49 .
drwxrwxr-x 4 rocio rocio  4096 Jul  6 09:40 ..
drwxrwxr-x 5 rocio rocio  4096 May 17 15:59 405-supprimer-svc-aws-dev
drwxrwxr-x 3 rocio rocio  4096 Jun 17 15:35 450-supprimer-svc-aws-prod
-rw-rw-r-- 1 rocio rocio 20854 Mar 29 13:48 ceai-317-new-accounts-mcn-lab-prod.ods
-rw-rw-r-- 1 rocio rocio  3954 Apr  2 07:34 ceai-317-sct-to-mcn-troubelshooting-app-prod
-rw-rw-r-- 1 rocio rocio 21476 Apr  5 06:22 ceai-317-transfer-users-sct-to-mcn
-rw-rw-r-- 1 rocio rocio  2653 Apr 11 09:23 ceai-335-retirer-vulnerabilites-des-repos
-rw-rw-r-- 1 rocio rocio 24930 Apr 19 09:28 ceai-435-scripts-taiga-without-eks.ods
-rw-rw-r-- 1 rocio rocio   716 Apr 21 14:38 ceai-435-script-taiga-without-eks
-rw-rw-r-- 1 rocio rocio 10439 Apr 26 06:37 ceai-436-outils-gestion-doc.ods
-rw-rw-r-- 1 rocio rocio 56736 Apr 27 13:47 outils-gestion.jpg
-rw-rw-r-- 1 rocio rocio 52057 Apr 27 13:56 outils-gestion_v2.jpg
drwxrwxr-x 3 rocio rocio  4096 Jun 28 21:05 s17-121-guide-openshift-users-lab
drwxrwxr-x 2 rocio rocio  4096 Apr  7 15:18 scan-code-tools
-rw-rw-r-- 1 rocio rocio  2791 Mar 22 15:29 workaround-resend-email-by-command-line
rocio@cqen-rp:~/dev/cqen/tickets/ceai$ mkdir ceai-128-example-deployment-api-aws
rocio@cqen-rp:~/dev/cqen/tickets/ceai$ cd ceai-128-example-deployment-api-aws/
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws$ node --version
v10.9.0
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws$ terraform --version
Terraform v1.2.7
on linux_amd64
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws$ docker --version
Docker version 20.10.17, build 100c701
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws$ aws --version
aws-cli/2.4.16 Python/3.8.8 Linux/5.15.0-43-generic exe/x86_64.ubuntu.20 prompt/off
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws$ ls -la
total 64
drwxrwxr-x 4 rocio rocio  4096 Aug 17 14:55 .
drwxrwxr-x 7 rocio rocio  4096 Aug 17 12:18 ..
-rw-rw-r-- 1 rocio rocio   388 Aug 17 14:10 1-deploy-clojure-web-app.md
-rw-rw-r-- 1 rocio rocio   239 Aug 17 14:13 2-use-terraform-to-launch-ec2-instance-to-deploy-app.md
-rw-rw-r-- 1 rocio rocio   145 Aug 17 14:15 3-deploy-webapp-on-aws-using-terraform.md
-rw-rw-r-- 1 rocio rocio   454 Aug 17 14:20 4-deploy-multi-tiered-web-app.md
-rw-rw-r-- 1 rocio rocio   630 Aug 17 14:54 5-deploy-nodejs-app-aws-terraform.md
-rw-rw-r-- 1 rocio rocio  1230 Aug 17 14:08 .gitignore
drwxrwxr-x 3 rocio rocio 20480 Aug 17 14:57 .history
drwxrwxr-x 3 rocio rocio  4096 Aug 17 15:33 nodejs-aws-terraform
-rw-rw-r-- 1 rocio rocio  2305 Aug 17 14:07 README.md
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws$ cd nodejs-aws-terraform/
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ ls -la
total 48
drwxrwxr-x  3 rocio rocio  4096 Aug 17 15:33 .
drwxrwxr-x  4 rocio rocio  4096 Aug 17 14:55 ..
-rw-rw-r--  1 rocio rocio   128 Aug 17 14:57 app.js
-rw-rw-r--  1 rocio rocio   111 Aug 17 15:31 Dockerfile
-rw-rw-r--  1 rocio rocio    26 Aug 17 15:33 .dockerignore
drwxrwxr-x 59 rocio rocio  4096 Aug 17 14:56 node_modules
-rw-rw-r--  1 rocio rocio   266 Aug 17 14:56 package.json
-rw-rw-r--  1 rocio rocio 17922 Aug 17 14:56 package-lock.json
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ docker build -t nodejs-aws-terraform .
Sending build context to Docker daemon  24.06kB
Step 1/7 : FROM node:10
10: Pulling from library/node
76b8ef87096f: Pull complete 
2e2bafe8a0f4: Pull complete 
b53ce1fd2746: Pull complete 
84a8c1bd5887: Pull complete 
7a803dc0b40f: Pull complete 
b800e94e7303: Pull complete 
0da9fbf60d48: Pull complete 
04dccde934cf: Pull complete 
73269890f6fd: Pull complete 
Digest: sha256:59531d2835edd5161c8f9512f9e095b1836f7a1fcb0ab73e005ec46047384911
Status: Downloaded newer image for node:10
 ---> 28dca6642db8
Step 2/7 : WORKDIR /usr/src/app
 ---> Running in b013cda718fb
Removing intermediate container b013cda718fb
 ---> 992d21a96b0b
Step 3/7 : COPY package*.json ./
 ---> 241af0734830
Step 4/7 : RUN npm i
 ---> Running in 9dc44b11e726
npm WARN nodejs-aws-terraform@1.0.0 No description
npm WARN nodejs-aws-terraform@1.0.0 No repository field.

added 57 packages from 42 contributors and audited 57 packages in 0.75s

7 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities

Removing intermediate container 9dc44b11e726
 ---> 274195198579
Step 5/7 : COPY . .
 ---> 0c4c820fb4e7
Step 6/7 : EXPOSE 3000
 ---> Running in 699f2ad9599a
Removing intermediate container 699f2ad9599a
 ---> 2a216671b03b
Step 7/7 : CMD [ "node", "app.js" ]
 ---> Running in 6021f748da00
Removing intermediate container 6021f748da00
 ---> 4403607d6f8c
Successfully built 4403607d6f8c
Successfully tagged nodejs-aws-terraform:latest
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ docker images
REPOSITORY                                                              TAG                  IMAGE ID       CREATED         SIZE
<none>                                                                  <none>               d98f518d9da3   3 weeks ago     1.49GB
<none>                                                                  <none>               7fb509a3e490   3 weeks ago     1.49GB
<none>                                                                  <none>               29144966e4a3   3 weeks ago     1.49GB
<none>                                                                  <none>               5ee38c6fdf9c   3 weeks ago     1.49GB
<none>                                                                  <none>               337f5466f9a5   3 weeks ago     827MB
<none>                                                                  <none>               88300930ada0   3 weeks ago     844MB
<none>                                                                  <none>               a1bd5d728c14   3 weeks ago     341MB
devexchange                                                             latest               bdd024e47999   4 weeks ago     437MB
keycloak                                                                latest               05f4f16c8e13   4 weeks ago     1.11GB
<none>                                                                  <none>               cc08a3a4af1c   4 weeks ago     1.51GB
<none>                                                                  <none>               8bc9712e1425   4 weeks ago     1.54GB
<none>                                                                  <none>               546f901d6d8f   5 weeks ago     1.56GB
<none>                                                                  <none>               18343806271a   5 weeks ago     1.46GB
<none>                                                                  <none>               3b7e3f4f745a   5 weeks ago     1.46GB
<none>                                                                  <none>               aaa1fd0f6fe9   5 weeks ago     1.46GB
<none>                                                                  <none>               481197f6aa11   5 weeks ago     1.21GB
<none>                                                                  <none>               4c3512d998d9   5 weeks ago     2.01GB
<none>                                                                  <none>               994581f6fe0a   5 weeks ago     2.01GB
<none>                                                                  <none>               10e580cfde5f   5 weeks ago     905MB
<none>                                                                  <none>               b74bfc0d6578   5 weeks ago     794MB
<none>                                                                  <none>               2bb4074bd3da   5 weeks ago     855MB
<none>                                                                  <none>               38ec057a4e6e   5 weeks ago     827MB
<none>                                                                  <none>               267a494c93ab   5 weeks ago     586MB
postgres                                                                10                   1cad456b3a24   7 weeks ago     202MB
nginx                                                                   alpine               f246e6f9d0b2   8 weeks ago     23.5MB
simple-docker-compose_web                                               latest               095c8ccf4d81   2 months ago    182MB
redis                                                                   alpine               7c27c4f30af0   2 months ago    28.4MB
kanban_kanban-ui                                                        latest               8e5f44dc381a   2 months ago    22.3MB
kanban_kanban-app                                                       latest               34535278b565   2 months ago    151MB
yonepv/hello-world-nodejs                                               test-local-RELEASE   664d65b987b8   2 months ago    104MB
563293798633.dkr.ecr.ca-central-1.amazonaws.com/admin-api-upd-dev-ecr   <none>               0b3bc709259b   4 months ago    273MB
node                                                                    16.13                304de6a23023   6 months ago    905MB
postgres                                                                9.6-alpine           4cbcabaa33be   7 months ago    53.6MB
selenium/standalone-chrome-debug                                        latest               aaf43463c572   10 months ago   1.11GB
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ docker build -t nodejs-aws-terraform .
Sending build context to Docker daemon  24.06kB
Step 1/7 : FROM node:10
10: Pulling from library/node
76b8ef87096f: Pull complete 
2e2bafe8a0f4: Pull complete 
b53ce1fd2746: Pull complete 
84a8c1bd5887: Pull complete 
7a803dc0b40f: Pull complete 
b800e94e7303: Pull complete 
0da9fbf60d48: Pull complete 
04dccde934cf: Pull complete 
73269890f6fd: Pull complete 
Digest: sha256:59531d2835edd5161c8f9512f9e095b1836f7a1fcb0ab73e005ec46047384911
Status: Downloaded newer image for node:10
 ---> 28dca6642db8
Step 2/7 : WORKDIR /usr/src/app
 ---> Running in fdbc3d5b1070
Removing intermediate container fdbc3d5b1070
 ---> ed6a1c7e8ac6
Step 3/7 : COPY package*.json ./
 ---> f52f7a73a454
Step 4/7 : RUN npm i
 ---> Running in 44e641111b70
npm WARN nodejs-aws-terraform@1.0.0 No description
npm WARN nodejs-aws-terraform@1.0.0 No repository field.

added 57 packages from 42 contributors and audited 57 packages in 0.838s

7 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities

Removing intermediate container 44e641111b70
 ---> afb04910c673
Step 5/7 : COPY . .
 ---> 6fd2c77a1a5c
Step 6/7 : EXPOSE 3000
 ---> Running in d198a0643665
Removing intermediate container d198a0643665
 ---> 4b8748ace28a
Step 7/7 : CMD [ "node", "app.js" ]
 ---> Running in 1870ae1b97e3
Removing intermediate container 1870ae1b97e3
 ---> ccdd4a04a89e
Successfully built ccdd4a04a89e
Successfully tagged nodejs-aws-terraform:latest
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ docker images
REPOSITORY                                                              TAG                  IMAGE ID       CREATED         SIZE
nodejs-aws-terraform                                                    latest               ccdd4a04a89e   3 seconds ago   913MB
<none>                                                                  <none>               d98f518d9da3   3 weeks ago     1.49GB
<none>                                                                  <none>               7fb509a3e490   3 weeks ago     1.49GB
<none>                                                                  <none>               29144966e4a3   3 weeks ago     1.49GB
<none>                                                                  <none>               5ee38c6fdf9c   3 weeks ago     1.49GB
<none>                                                                  <none>               337f5466f9a5   3 weeks ago     827MB
<none>                                                                  <none>               88300930ada0   3 weeks ago     844MB
<none>                                                                  <none>               a1bd5d728c14   3 weeks ago     341MB
devexchange                                                             latest               bdd024e47999   4 weeks ago     437MB
keycloak                                                                latest               05f4f16c8e13   4 weeks ago     1.11GB
<none>                                                                  <none>               cc08a3a4af1c   4 weeks ago     1.51GB
<none>                                                                  <none>               8bc9712e1425   4 weeks ago     1.54GB
<none>                                                                  <none>               546f901d6d8f   5 weeks ago     1.56GB
<none>                                                                  <none>               18343806271a   5 weeks ago     1.46GB
<none>                                                                  <none>               3b7e3f4f745a   5 weeks ago     1.46GB
<none>                                                                  <none>               aaa1fd0f6fe9   5 weeks ago     1.46GB
<none>                                                                  <none>               481197f6aa11   5 weeks ago     1.21GB
<none>                                                                  <none>               4c3512d998d9   5 weeks ago     2.01GB
<none>                                                                  <none>               994581f6fe0a   5 weeks ago     2.01GB
<none>                                                                  <none>               10e580cfde5f   5 weeks ago     905MB
<none>                                                                  <none>               b74bfc0d6578   5 weeks ago     794MB
<none>                                                                  <none>               2bb4074bd3da   5 weeks ago     855MB
<none>                                                                  <none>               38ec057a4e6e   5 weeks ago     827MB
<none>                                                                  <none>               267a494c93ab   5 weeks ago     586MB
postgres                                                                10                   1cad456b3a24   7 weeks ago     202MB
nginx                                                                   alpine               f246e6f9d0b2   8 weeks ago     23.5MB
simple-docker-compose_web                                               latest               095c8ccf4d81   2 months ago    182MB
redis                                                                   alpine               7c27c4f30af0   2 months ago    28.4MB
kanban_kanban-ui                                                        latest               8e5f44dc381a   2 months ago    22.3MB
kanban_kanban-app                                                       latest               34535278b565   2 months ago    151MB
yonepv/hello-world-nodejs                                               test-local-RELEASE   664d65b987b8   2 months ago    104MB
563293798633.dkr.ecr.ca-central-1.amazonaws.com/admin-api-upd-dev-ecr   <none>               0b3bc709259b   4 months ago    273MB
node                                                                    16.13                304de6a23023   6 months ago    905MB
postgres                                                                9.6-alpine           4cbcabaa33be   7 months ago    53.6MB
selenium/standalone-chrome-debug                                        latest               aaf43463c572   10 months ago   1.11GB
node                                                                    10                   28dca6642db8   16 months ago   910MB
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ docker run -p 12345:3000 -d nodejs-aws-terraform
db06d092b5e9a42b3f5640a309597369c8c4687297d7cc33b8514dfd4246e210
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ docker ps
CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                         NAMES
db06d092b5e9   nodejs-aws-terraform   "docker-entrypoint.s…"   5 minutes ago   Up 5 minutes   0.0.0.0:12345->3000/tcp, :::12345->3000/tcp   competent_gagarin
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ docker stop nodejs-aws-terraform
Error response from daemon: No such container: nodejs-aws-terraform
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ docker stop competent_gagarin 
competent_gagarin
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform$ cd deployment/
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ aws sso login --profile dev_cqen_aws15
Attempting to automatically open the SSO authorization page in your default browser.
If the browser does not open or you wish to use a different device to authorize this request, open the following URL:

https://device.sso.ca-central-1.amazonaws.com/

Then enter the code:

XKRF-RZJG
Successully logged into Start URL: https://ceai.awsapps.com/start#/
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ terraform init

Initializing the backend...

Initializing provider plugins...
- Finding latest version of hashicorp/aws...
- Installing hashicorp/aws v4.26.0...
- Installed hashicorp/aws v4.26.0 (signed by HashiCorp)

Terraform has created a lock file .terraform.lock.hcl to record the provider
selections it made above. Include this file in your version control repository
so that Terraform can guarantee to make the same selections by default when
you run "terraform init" in the future.

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ terraform plan

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following
symbols:
  + create

Terraform will perform the following actions:

  # aws_ecr_repository.ecr_repo will be created
  + resource "aws_ecr_repository" "ecr_repo" {
      + arn                  = (known after apply)
      + id                   = (known after apply)
      + image_tag_mutability = "MUTABLE"
      + name                 = "ecr_demo_nodejs_repo"
      + registry_id          = (known after apply)
      + repository_url       = (known after apply)
      + tags_all             = (known after apply)
    }

Plan: 1 to add, 0 to change, 0 to destroy.

─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Note: You didn't use the -out option to save this plan, so Terraform can't guarantee to take exactly these actions if you run
"terraform apply" now.
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ terraform apply

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following
symbols:
  + create

Terraform will perform the following actions:

  # aws_ecr_repository.ecr_repo will be created
  + resource "aws_ecr_repository" "ecr_repo" {
      + arn                  = (known after apply)
      + id                   = (known after apply)
      + image_tag_mutability = "MUTABLE"
      + name                 = "ecr_demo_nodejs_repo"
      + registry_id          = (known after apply)
      + repository_url       = (known after apply)
      + tags_all             = (known after apply)
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

aws_ecr_repository.ecr_repo: Creating...
aws_ecr_repository.ecr_repo: Creation complete after 1s [id=ecr_demo_nodejs_repo]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ aws ecr get-login-password --region ca-central-1 | docker login --username AWS --password-stdin 698033540909.dkr.ecr.ca-central-1.amazonaws.com

An error occurred (UnrecognizedClientException) when calling the GetAuthorizationToken operation: The security token included in the request is invalid.
Error: Cannot perform an interactive login from a non TTY device
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ aws ecr get-login-password --region ca-central-1 --profile dev_cqen_aws15  | docker login --username AWS --password-stdin 698033540909.dkr.ecr.ca-central-1.amazonaws.com
WARNING! Your password will be stored unencrypted in /home/rocio/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ docker images
REPOSITORY                                                              TAG                  IMAGE ID       CREATED          SIZE
nodejs-aws-terraform                                                    latest               ccdd4a04a89e   54 minutes ago   913MB
<none>                                                                  <none>               d98f518d9da3   3 weeks ago      1.49GB
<none>                                                                  <none>               7fb509a3e490   3 weeks ago      1.49GB
<none>                                                                  <none>               29144966e4a3   3 weeks ago      1.49GB
<none>                                                                  <none>               5ee38c6fdf9c   3 weeks ago      1.49GB
<none>                                                                  <none>               337f5466f9a5   3 weeks ago      827MB
<none>                                                                  <none>               88300930ada0   3 weeks ago      844MB
<none>                                                                  <none>               a1bd5d728c14   3 weeks ago      341MB
devexchange                                                             latest               bdd024e47999   4 weeks ago      437MB
keycloak                                                                latest               05f4f16c8e13   4 weeks ago      1.11GB
<none>                                                                  <none>               cc08a3a4af1c   4 weeks ago      1.51GB
<none>                                                                  <none>               8bc9712e1425   4 weeks ago      1.54GB
<none>                                                                  <none>               546f901d6d8f   5 weeks ago      1.56GB
<none>                                                                  <none>               18343806271a   5 weeks ago      1.46GB
<none>                                                                  <none>               3b7e3f4f745a   5 weeks ago      1.46GB
<none>                                                                  <none>               aaa1fd0f6fe9   5 weeks ago      1.46GB
<none>                                                                  <none>               481197f6aa11   5 weeks ago      1.21GB
<none>                                                                  <none>               4c3512d998d9   5 weeks ago      2.01GB
<none>                                                                  <none>               994581f6fe0a   5 weeks ago      2.01GB
<none>                                                                  <none>               10e580cfde5f   5 weeks ago      905MB
<none>                                                                  <none>               b74bfc0d6578   5 weeks ago      794MB
<none>                                                                  <none>               2bb4074bd3da   5 weeks ago      855MB
<none>                                                                  <none>               38ec057a4e6e   5 weeks ago      827MB
<none>                                                                  <none>               267a494c93ab   5 weeks ago      586MB
postgres                                                                10                   1cad456b3a24   7 weeks ago      202MB
nginx                                                                   alpine               f246e6f9d0b2   8 weeks ago      23.5MB
simple-docker-compose_web                                               latest               095c8ccf4d81   2 months ago     182MB
redis                                                                   alpine               7c27c4f30af0   2 months ago     28.4MB
kanban_kanban-ui                                                        latest               8e5f44dc381a   2 months ago     22.3MB
kanban_kanban-app                                                       latest               34535278b565   2 months ago     151MB
yonepv/hello-world-nodejs                                               test-local-RELEASE   664d65b987b8   2 months ago     104MB
563293798633.dkr.ecr.ca-central-1.amazonaws.com/admin-api-upd-dev-ecr   <none>               0b3bc709259b   4 months ago     273MB
node                                                                    16.13                304de6a23023   6 months ago     905MB
postgres                                                                9.6-alpine           4cbcabaa33be   7 months ago     53.6MB
selenium/standalone-chrome-debug                                        latest               aaf43463c572   10 months ago    1.11GB
node                                                                    10                   28dca6642db8   16 months ago    910MB
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ docker images
REPOSITORY                                                              TAG                  IMAGE ID       CREATED          SIZE
nodejs-aws-terraform                                                    latest               ccdd4a04a89e   55 minutes ago   913MB
<none>                                                                  <none>               d98f518d9da3   3 weeks ago      1.49GB
<none>                                                                  <none>               7fb509a3e490   3 weeks ago      1.49GB
<none>                                                                  <none>               29144966e4a3   3 weeks ago      1.49GB
<none>                                                                  <none>               5ee38c6fdf9c   3 weeks ago      1.49GB
<none>                                                                  <none>               337f5466f9a5   3 weeks ago      827MB
<none>                                                                  <none>               88300930ada0   3 weeks ago      844MB
<none>                                                                  <none>               a1bd5d728c14   3 weeks ago      341MB
devexchange                                                             latest               bdd024e47999   4 weeks ago      437MB
keycloak                                                                latest               05f4f16c8e13   4 weeks ago      1.11GB
<none>                                                                  <none>               cc08a3a4af1c   4 weeks ago      1.51GB
<none>                                                                  <none>               8bc9712e1425   4 weeks ago      1.54GB
<none>                                                                  <none>               546f901d6d8f   5 weeks ago      1.56GB
<none>                                                                  <none>               18343806271a   5 weeks ago      1.46GB
<none>                                                                  <none>               3b7e3f4f745a   5 weeks ago      1.46GB
<none>                                                                  <none>               aaa1fd0f6fe9   5 weeks ago      1.46GB
<none>                                                                  <none>               481197f6aa11   5 weeks ago      1.21GB
<none>                                                                  <none>               4c3512d998d9   5 weeks ago      2.01GB
<none>                                                                  <none>               994581f6fe0a   5 weeks ago      2.01GB
<none>                                                                  <none>               10e580cfde5f   5 weeks ago      905MB
<none>                                                                  <none>               b74bfc0d6578   5 weeks ago      794MB
<none>                                                                  <none>               2bb4074bd3da   5 weeks ago      855MB
<none>                                                                  <none>               38ec057a4e6e   5 weeks ago      827MB
<none>                                                                  <none>               267a494c93ab   5 weeks ago      586MB
postgres                                                                10                   1cad456b3a24   7 weeks ago      202MB
nginx                                                                   alpine               f246e6f9d0b2   8 weeks ago      23.5MB
simple-docker-compose_web                                               latest               095c8ccf4d81   2 months ago     182MB
redis                                                                   alpine               7c27c4f30af0   2 months ago     28.4MB
kanban_kanban-ui                                                        latest               8e5f44dc381a   2 months ago     22.3MB
kanban_kanban-app                                                       latest               34535278b565   2 months ago     151MB
yonepv/hello-world-nodejs                                               test-local-RELEASE   664d65b987b8   2 months ago     104MB
563293798633.dkr.ecr.ca-central-1.amazonaws.com/admin-api-upd-dev-ecr   <none>               0b3bc709259b   4 months ago     273MB
node                                                                    16.13                304de6a23023   6 months ago     905MB
postgres                                                                9.6-alpine           4cbcabaa33be   7 months ago     53.6MB
selenium/standalone-chrome-debug                                        latest               aaf43463c572   10 months ago    1.11GB
node                                                                    10                   28dca6642db8   16 months ago    910MB
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ docker tag nodejs-aws-terraform:latest 698033540909.dkr.ecr.ca-central-1.amazonaws.com/ecr_demo_nodejs_repo:latest
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ docker images
REPOSITORY                                                              TAG                  IMAGE ID       CREATED          SIZE
698033540909.dkr.ecr.ca-central-1.amazonaws.com/ecr_demo_nodejs_repo    latest               ccdd4a04a89e   56 minutes ago   913MB
nodejs-aws-terraform                                                    latest               ccdd4a04a89e   56 minutes ago   913MB
<none>                                                                  <none>               d98f518d9da3   3 weeks ago      1.49GB
<none>                                                                  <none>               7fb509a3e490   3 weeks ago      1.49GB
<none>                                                                  <none>               29144966e4a3   3 weeks ago      1.49GB
<none>                                                                  <none>               5ee38c6fdf9c   3 weeks ago      1.49GB
<none>                                                                  <none>               337f5466f9a5   3 weeks ago      827MB
<none>                                                                  <none>               88300930ada0   3 weeks ago      844MB
<none>                                                                  <none>               a1bd5d728c14   3 weeks ago      341MB
devexchange                                                             latest               bdd024e47999   4 weeks ago      437MB
keycloak                                                                latest               05f4f16c8e13   4 weeks ago      1.11GB
<none>                                                                  <none>               cc08a3a4af1c   4 weeks ago      1.51GB
<none>                                                                  <none>               8bc9712e1425   4 weeks ago      1.54GB
<none>                                                                  <none>               546f901d6d8f   5 weeks ago      1.56GB
<none>                                                                  <none>               18343806271a   5 weeks ago      1.46GB
<none>                                                                  <none>               3b7e3f4f745a   5 weeks ago      1.46GB
<none>                                                                  <none>               aaa1fd0f6fe9   5 weeks ago      1.46GB
<none>                                                                  <none>               481197f6aa11   5 weeks ago      1.21GB
<none>                                                                  <none>               4c3512d998d9   5 weeks ago      2.01GB
<none>                                                                  <none>               994581f6fe0a   5 weeks ago      2.01GB
<none>                                                                  <none>               10e580cfde5f   5 weeks ago      905MB
<none>                                                                  <none>               b74bfc0d6578   5 weeks ago      794MB
<none>                                                                  <none>               2bb4074bd3da   5 weeks ago      855MB
<none>                                                                  <none>               38ec057a4e6e   5 weeks ago      827MB
<none>                                                                  <none>               267a494c93ab   5 weeks ago      586MB
postgres                                                                10                   1cad456b3a24   7 weeks ago      202MB
nginx                                                                   alpine               f246e6f9d0b2   8 weeks ago      23.5MB
simple-docker-compose_web                                               latest               095c8ccf4d81   2 months ago     182MB
redis                                                                   alpine               7c27c4f30af0   2 months ago     28.4MB
kanban_kanban-ui                                                        latest               8e5f44dc381a   2 months ago     22.3MB
kanban_kanban-app                                                       latest               34535278b565   2 months ago     151MB
yonepv/hello-world-nodejs                                               test-local-RELEASE   664d65b987b8   2 months ago     104MB
563293798633.dkr.ecr.ca-central-1.amazonaws.com/admin-api-upd-dev-ecr   <none>               0b3bc709259b   4 months ago     273MB
node                                                                    16.13                304de6a23023   6 months ago     905MB
postgres                                                                9.6-alpine           4cbcabaa33be   7 months ago     53.6MB
selenium/standalone-chrome-debug                                        latest               aaf43463c572   10 months ago    1.11GB
node                                                                    10                   28dca6642db8   16 months ago    910MB
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ docker push 698033540909.dkr.ecr.ca-central-1.amazonaws.com/ecr_demo_nodejs_repo:latest
The push refers to repository [698033540909.dkr.ecr.ca-central-1.amazonaws.com/ecr_demo_nodejs_repo]
27235615ad1c: Pushed 
6d4bde1836f5: Pushed 
d8474e1c6701: Pushed 
133acc37d507: Pushed 
3ab01e8988bf: Pushed 
c98dc9a94132: Pushed 
3ffdb7e28503: Pushed 
33dd93485756: Pushed 
607d71c12b77: Pushed 
052174538f53: Pushed 
8abfe7e7c816: Pushed 
c8b886062a47: Pushed 
16fc2e3ca032: Pushed 
latest: digest: sha256:4848f5cff47827fc17ea8a4d8a095974806d8f554cdd7a4b3c39aff1985bf8e5 size: 3049
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ terraform init

Initializing the backend...

Initializing provider plugins...
- Reusing previous version of hashicorp/aws from the dependency lock file
- Using previously-installed hashicorp/aws v4.26.0

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ terraform plan
╷
│ Error: Reference to undeclared input variable
│ 
│   on data.tf line 9, in data "aws_subnet" "public_a":
│    9:     availability_zone = "${var.aws_region}a"
│ 
│ An input variable with the name "aws_region" has not been declared. This variable can be declared with a variable "aws_region" {}
│ block.
╵
╷
│ Error: Reference to undeclared input variable
│ 
│   on data.tf line 17, in data "aws_subnet" "public_b":
│   17:     availability_zone = "${var.aws_region}b"
│ 
│ An input variable with the name "aws_region" has not been declared. This variable can be declared with a variable "aws_region" {}
│ block.
╵
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ terraform plan
╷
│ Error: Unsupported argument
│ 
│   on vars.tf line 1:
│    1: aws_region = "ca-central-1"
│ 
│ An argument named "aws_region" is not expected here.
╵
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ terraform plan
╷
│ Error: error configuring Terraform AWS Provider: no valid credential sources for Terraform AWS Provider found.
│ 
│ Please see https://registry.terraform.io/providers/hashicorp/aws
│ for more information about providing credentials.
│ 
│ Error: failed to refresh cached credentials, the SSO session has expired or is invalid: access token is expired
│ 
│ 
│   with provider["registry.terraform.io/hashicorp/aws"],
│   on provider.tf line 1, in provider "aws":
│    1: provider "aws" {
│ 
╵
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ aws sso login --profile dev_cqen_aws15
Attempting to automatically open the SSO authorization page in your default browser.
If the browser does not open or you wish to use a different device to authorize this request, open the following URL:

https://device.sso.ca-central-1.amazonaws.com/

Then enter the code:

ZTXL-CZLM
Successully logged into Start URL: https://ceai.awsapps.com/start#/
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ terraform plan
data.aws_vpc.selected: Reading...
aws_ecr_repository.ecr_repo: Refreshing state... [id=ecr_demo_nodejs_repo]
data.aws_vpc.selected: Read complete after 0s [id=vpc-09314f9c8a31695ff]
data.aws_subnet.public_a: Reading...
data.aws_subnet.public_b: Reading...
data.aws_subnet.public_a: Read complete after 0s [id=subnet-09190b7878dc70cb5]
data.aws_subnet.public_b: Read complete after 0s [id=subnet-0a13c0d5b26348f47]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following
symbols:
  + create

Terraform will perform the following actions:

  # aws_ecs_cluster.backend_cluster will be created
  + resource "aws_ecs_cluster" "backend_cluster" {
      + arn                = (known after apply)
      + capacity_providers = (known after apply)
      + id                 = (known after apply)
      + name               = "backend_cluster_example_app"
      + tags_all           = (known after apply)

      + default_capacity_provider_strategy {
          + base              = (known after apply)
          + capacity_provider = (known after apply)
          + weight            = (known after apply)
        }

      + setting {
          + name  = (known after apply)
          + value = (known after apply)
        }
    }

  # aws_ecs_service.backend_service will be created
  + resource "aws_ecs_service" "backend_service" {
      + cluster                            = (known after apply)
      + deployment_maximum_percent         = 200
      + deployment_minimum_healthy_percent = 100
      + desired_count                      = 1
      + enable_ecs_managed_tags            = false
      + enable_execute_command             = false
      + iam_role                           = (known after apply)
      + id                                 = (known after apply)
      + launch_type                        = "FARGATE"
      + name                               = "backend_service"
      + platform_version                   = (known after apply)
      + scheduling_strategy                = "REPLICA"
      + tags_all                           = (known after apply)
      + task_definition                    = (known after apply)
      + wait_for_steady_state              = false

      + network_configuration {
          + assign_public_ip = true
          + security_groups  = (known after apply)
          + subnets          = [
              + "subnet-09190b7878dc70cb5",
              + "subnet-0a13c0d5b26348f47",
            ]
        }
    }

  # aws_ecs_task_definition.backend_task will be created
  + resource "aws_ecs_task_definition" "backend_task" {
      + arn                      = (known after apply)
      + container_definitions    = jsonencode(
            [
              + {
                  + essential    = true
                  + image        = "698033540909.dkr.ecr.ca-central-1.amazonaws.com/ecr_demo_nodejs_repo:latest"
                  + memory       = 512
                  + name         = "nodejs_example_app_container"
                  + portMappings = [
                      + {
                          + containerPort = 3000
                          + hostPort      = 3000
                        },
                    ]
                },
            ]
        )
      + cpu                      = "256"
      + execution_role_arn       = (known after apply)
      + family                   = "backend_example_app_family"
      + id                       = (known after apply)
      + memory                   = "512"
      + network_mode             = "awsvpc"
      + requires_compatibilities = [
          + "FARGATE",
        ]
      + revision                 = (known after apply)
      + skip_destroy             = false
      + tags_all                 = (known after apply)
    }

  # aws_iam_role.ecs_role will be created
  + resource "aws_iam_role" "ecs_role" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRole"
                      + Effect    = "Allow"
                      + Principal = {
                          + Service = "ecs-tasks.amazonaws.com"
                        }
                      + Sid       = ""
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = (known after apply)
      + max_session_duration  = 3600
      + name                  = "ecs_role_nodejs_example_app"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags_all              = (known after apply)
      + unique_id             = (known after apply)

      + inline_policy {
          + name   = (known after apply)
          + policy = (known after apply)
        }
    }

  # aws_iam_role_policy_attachment.ecs_policy_attachment will be created
  + resource "aws_iam_role_policy_attachment" "ecs_policy_attachment" {
      + id         = (known after apply)
      + policy_arn = "arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"
      + role       = "ecs_role_nodejs_example_app"
    }

  # aws_internet_gateway.internet_gateway will be created
  + resource "aws_internet_gateway" "internet_gateway" {
      + arn      = (known after apply)
      + id       = (known after apply)
      + owner_id = (known after apply)
      + tags_all = (known after apply)
      + vpc_id   = "vpc-09314f9c8a31695ff"
    }

  # aws_route.internet_access will be created
  + resource "aws_route" "internet_access" {
      + destination_cidr_block = "0.0.0.0/0"
      + gateway_id             = (known after apply)
      + id                     = (known after apply)
      + instance_id            = (known after apply)
      + instance_owner_id      = (known after apply)
      + network_interface_id   = (known after apply)
      + origin                 = (known after apply)
      + route_table_id         = "rtb-06e16b0b60c1907fa"
      + state                  = (known after apply)
    }

  # aws_security_group.security_group_example_app will be created
  + resource "aws_security_group" "security_group_example_app" {
      + arn                    = (known after apply)
      + description            = "Allow TLS inbound traffic on port 80 (http)"
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + description      = ""
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "-1"
              + security_groups  = []
              + self             = false
              + to_port          = 0
            },
        ]
      + id                     = (known after apply)
      + ingress                = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + description      = ""
              + from_port        = 80
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "tcp"
              + security_groups  = []
              + self             = false
              + to_port          = 3000
            },
        ]
      + name                   = "security_group_example_app"
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + revoke_rules_on_delete = false
      + tags_all               = (known after apply)
      + vpc_id                 = "vpc-09314f9c8a31695ff"
    }

Plan: 8 to add, 0 to change, 0 to destroy.

─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Note: You didn't use the -out option to save this plan, so Terraform can't guarantee to take exactly these actions if you run
"terraform apply" now.
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ terraform apply
data.aws_vpc.selected: Reading...
aws_ecr_repository.ecr_repo: Refreshing state... [id=ecr_demo_nodejs_repo]
data.aws_vpc.selected: Read complete after 0s [id=vpc-09314f9c8a31695ff]
data.aws_subnet.public_a: Reading...
data.aws_subnet.public_b: Reading...
data.aws_subnet.public_b: Read complete after 0s [id=subnet-0a13c0d5b26348f47]
data.aws_subnet.public_a: Read complete after 0s [id=subnet-09190b7878dc70cb5]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following
symbols:
  + create

Terraform will perform the following actions:

  # aws_ecs_cluster.backend_cluster will be created
  + resource "aws_ecs_cluster" "backend_cluster" {
      + arn                = (known after apply)
      + capacity_providers = (known after apply)
      + id                 = (known after apply)
      + name               = "backend_cluster_example_app"
      + tags_all           = (known after apply)

      + default_capacity_provider_strategy {
          + base              = (known after apply)
          + capacity_provider = (known after apply)
          + weight            = (known after apply)
        }

      + setting {
          + name  = (known after apply)
          + value = (known after apply)
        }
    }

  # aws_ecs_service.backend_service will be created
  + resource "aws_ecs_service" "backend_service" {
      + cluster                            = (known after apply)
      + deployment_maximum_percent         = 200
      + deployment_minimum_healthy_percent = 100
      + desired_count                      = 1
      + enable_ecs_managed_tags            = false
      + enable_execute_command             = false
      + iam_role                           = (known after apply)
      + id                                 = (known after apply)
      + launch_type                        = "FARGATE"
      + name                               = "backend_service"
      + platform_version                   = (known after apply)
      + scheduling_strategy                = "REPLICA"
      + tags_all                           = (known after apply)
      + task_definition                    = (known after apply)
      + wait_for_steady_state              = false

      + network_configuration {
          + assign_public_ip = true
          + security_groups  = (known after apply)
          + subnets          = [
              + "subnet-09190b7878dc70cb5",
              + "subnet-0a13c0d5b26348f47",
            ]
        }
    }

  # aws_ecs_task_definition.backend_task will be created
  + resource "aws_ecs_task_definition" "backend_task" {
      + arn                      = (known after apply)
      + container_definitions    = jsonencode(
            [
              + {
                  + essential    = true
                  + image        = "698033540909.dkr.ecr.ca-central-1.amazonaws.com/ecr_demo_nodejs_repo:latest"
                  + memory       = 512
                  + name         = "nodejs_example_app_container"
                  + portMappings = [
                      + {
                          + containerPort = 3000
                          + hostPort      = 3000
                        },
                    ]
                },
            ]
        )
      + cpu                      = "256"
      + execution_role_arn       = (known after apply)
      + family                   = "backend_example_app_family"
      + id                       = (known after apply)
      + memory                   = "512"
      + network_mode             = "awsvpc"
      + requires_compatibilities = [
          + "FARGATE",
        ]
      + revision                 = (known after apply)
      + skip_destroy             = false
      + tags_all                 = (known after apply)
    }

  # aws_iam_role.ecs_role will be created
  + resource "aws_iam_role" "ecs_role" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRole"
                      + Effect    = "Allow"
                      + Principal = {
                          + Service = "ecs-tasks.amazonaws.com"
                        }
                      + Sid       = ""
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = (known after apply)
      + max_session_duration  = 3600
      + name                  = "ecs_role_nodejs_example_app"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags_all              = (known after apply)
      + unique_id             = (known after apply)

      + inline_policy {
          + name   = (known after apply)
          + policy = (known after apply)
        }
    }

  # aws_iam_role_policy_attachment.ecs_policy_attachment will be created
  + resource "aws_iam_role_policy_attachment" "ecs_policy_attachment" {
      + id         = (known after apply)
      + policy_arn = "arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"
      + role       = "ecs_role_nodejs_example_app"
    }

  # aws_internet_gateway.internet_gateway will be created
  + resource "aws_internet_gateway" "internet_gateway" {
      + arn      = (known after apply)
      + id       = (known after apply)
      + owner_id = (known after apply)
      + tags_all = (known after apply)
      + vpc_id   = "vpc-09314f9c8a31695ff"
    }

  # aws_route.internet_access will be created
  + resource "aws_route" "internet_access" {
      + destination_cidr_block = "0.0.0.0/0"
      + gateway_id             = (known after apply)
      + id                     = (known after apply)
      + instance_id            = (known after apply)
      + instance_owner_id      = (known after apply)
      + network_interface_id   = (known after apply)
      + origin                 = (known after apply)
      + route_table_id         = "rtb-06e16b0b60c1907fa"
      + state                  = (known after apply)
    }

  # aws_security_group.security_group_example_app will be created
  + resource "aws_security_group" "security_group_example_app" {
      + arn                    = (known after apply)
      + description            = "Allow TLS inbound traffic on port 80 (http)"
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + description      = ""
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "-1"
              + security_groups  = []
              + self             = false
              + to_port          = 0
            },
        ]
      + id                     = (known after apply)
      + ingress                = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + description      = ""
              + from_port        = 80
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "tcp"
              + security_groups  = []
              + self             = false
              + to_port          = 3000
            },
        ]
      + name                   = "security_group_example_app"
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + revoke_rules_on_delete = false
      + tags_all               = (known after apply)
      + vpc_id                 = "vpc-09314f9c8a31695ff"
    }

Plan: 8 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

aws_internet_gateway.internet_gateway: Creating...
aws_ecs_cluster.backend_cluster: Creating...
aws_iam_role.ecs_role: Creating...
aws_security_group.security_group_example_app: Creating...
aws_iam_role.ecs_role: Creation complete after 0s [id=ecs_role_nodejs_example_app]
aws_iam_role_policy_attachment.ecs_policy_attachment: Creating...
aws_ecs_task_definition.backend_task: Creating...
aws_ecs_task_definition.backend_task: Creation complete after 1s [id=backend_example_app_family]
aws_iam_role_policy_attachment.ecs_policy_attachment: Creation complete after 1s [id=ecs_role_nodejs_example_app-20220818143357573000000001]
aws_security_group.security_group_example_app: Creation complete after 1s [id=sg-0d6c6d386f7a319b9]
aws_ecs_cluster.backend_cluster: Still creating... [10s elapsed]
aws_ecs_cluster.backend_cluster: Creation complete after 10s [id=arn:aws:ecs:ca-central-1:698033540909:cluster/backend_cluster_example_app]
aws_ecs_service.backend_service: Creating...
aws_ecs_service.backend_service: Creation complete after 1s [id=arn:aws:ecs:ca-central-1:698033540909:service/backend_cluster_example_app/backend_service]
╷
│ Error: error creating EC2 Internet Gateway: UnauthorizedOperation: You are not authorized to perform this operation. Encoded authorization failure message: Wtj7iBjvB7ERZtZxR-YAnu3ffOEWO_pfiTtfIuUyEeGGigvgHwM04CPW5uaxiXtrQVASw6pWKoD_KeZCbXyQTstYwY-FLSH6CbRY3wBxCaRRwLbMPYiOb7oSPCiYD587lRwc_KWWTfZQqIanKBHF25N75293_efhkNWkO25T3i-TZo3lg2G0sJ3HxxW57eBZGAn1n-1VmjMsWv2IzXw2kjAasBU0noTNJew7t7VeBpOc6WeClZWo8TSB_M_akgK5D6aS8NVAbl-EATbDGZ6fHYkGCsPzHrCgyES7xGssvCqkxjWsafFPaj0MwGxhOT1CjiGcYL89yPXg8jgFG6wzI1N3FTAjv9GS8LaEBAqVyq-x8sQFbWvpa_xAqt1HIF7BOtKc_UescXDds08qKNDxoy0tIDW7j2MeqvAkDDXnCDHsdon4HQ-ihMC_xrhvcVYyb7pCiLPhjmHDM1QYCX-N-0tMgFhSGIuV0xm_ZGqCU8H7Ao9k9cTpXOtlhXWgCo3JVvNicfGbmtrpNBKHZG7RaBBaSYWGssJ6Xk5GUwhu6crg_HjaW1DIfC3PJvyfYqJXs4pHA3J1xdMlY8FKuXSt_whFV5--D9Uk3WaCJ-KZZj8Z2qAyB3LhPfrI1VydipUzQbtCHQHcCOEz4Co5lYWcPFcyqeQwvPyPG76abp2K2ZZQk8VXd8N92La0dl83Kp8dKudBblvcYsZYcCL-ln-7D6Wq_qjtFNsw0DOMGMoxkorTyKp6tzRweWDksvAvk0oc0RGyWqAfI-b_S_GPEnLYq7YoZGw5q-pZoCGivmYOyZxej4LFZ0GiD15HLhvvkQMJyZ34x77SWIgzOLva0qXjhZQNCjegry9gmVlCoy9scmeX3sOEYp8lZJjzIouPL5I-dBCzR1OW1Jq4oVD_AK-xydysD61ZBCEhQLzruNPZn7pLev7SgnSeqy6Kny87QX-eBxGAjI0tVW1pbOqsrEDa-3F7O23KvD0H3LxEzld7GJBz-e53KkjE7QS-2YXzXyv4Xinf0ukZpC5KokP-aRiOgwaGnKsz9jti5aXgMb7v4l7nLd2x-J0obE1S7MaRCL9WA_3pfzcX5KC5Z12k5QraNTd66HyfV2xyd3Vs17ZT5LtnTfotj59W1auIOgRioTmoxTGxnFU5x1fC-GuODijrXNoqqgEBp96KnbJa5lZEZbyTdBDDXkdFnUdRbGCHgt78RpF0321WAje-a0s
│ 	status code: 403, request id: 2f23c4ed-9e02-46ab-9639-0deb0e53850c
│ 
│   with aws_internet_gateway.internet_gateway,
│   on network.tf line 20, in resource "aws_internet_gateway" "internet_gateway":
│   20: resource "aws_internet_gateway" "internet_gateway" {
│ 
╵
rocio@cqen-rp:~/dev/cqen/tickets/ceai/ceai-128-example-deployment-api-aws/nodejs-aws-terraform/deployment$ 

